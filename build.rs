extern crate bindgen;

use std::env;
use std::path::{PathBuf};

fn main() {
  let out_dir = PathBuf::from(env::var("OUT_DIR").unwrap());
  let cudnn_bindings = bindgen::Builder::default()
    .clang_arg("-I/opt/cudnn-7.0.3-cuda-8.0/include")
    .clang_arg("-I/usr/local/cuda/include")
    .header("wrap.h")
    .link("cudnn")
    .whitelist_recursively(false)
    .whitelisted_var("CUDNN_MAJOR")
    .whitelisted_var("CUDNN_MINOR")
    .whitelisted_var("CUDNN_PATCHLEVEL")
    .whitelisted_type("cudnnContext")
    .whitelisted_type("cudnnHandle_t")
    .whitelisted_type("cudnnStatus_t")
    .whitelisted_function("cudnnGetErrorString")
    .whitelisted_function("cudnnCreate")
    .whitelisted_function("cudnnDestroy")
    .whitelisted_function("cudnnSetStream")
    .whitelisted_function("cudnnGetStream")
    .whitelisted_type("cudnnTensorStruct")
    .whitelisted_type("cudnnTensorDescriptor_t")
    .whitelisted_type("cudnnConvolutionStruct")
    .whitelisted_type("cudnnConvolutionDescriptor_t")
    .whitelisted_type("cudnnPoolingStruct")
    .whitelisted_type("cudnnPoolingDescriptor_t")
    .whitelisted_type("cudnnFilterStruct")
    .whitelisted_type("cudnnFilterDescriptor_t")
    .whitelisted_type("cudnnActivationStruct")
    .whitelisted_type("cudnnActivationDescriptor_t")
    .whitelisted_type("cudnnOpTensorStruct")
    .whitelisted_type("cudnnOpTensorDescriptor_t")
    .whitelisted_type("cudnnReduceTensorStruct")
    .whitelisted_type("cudnnReduceTensorDescriptor_t")
    .whitelisted_type("cudnnDataType_t")
    .whitelisted_type("cudnnMathType_t")
    .whitelisted_type("cudnnNanPropagation_t")
    .whitelisted_type("cudnnDeterminism_t")
    .whitelisted_function("cudnnCreateTensorDescriptor")
    .whitelisted_type("cudnnTensorFormat_t")
    .whitelisted_function("cudnnSetTensor4dDescriptor")
    .whitelisted_function("cudnnSetTensor4dDescriptorEx")
    .whitelisted_function("cudnnGetTensor4dDescriptor")
    .whitelisted_function("cudnnSetTensorNdDescriptor")
    .whitelisted_function("cudnnSetTensorNdDescriptorEx")
    .whitelisted_function("cudnnGetTensorNdDescriptor")
    .whitelisted_function("cudnnGetTensorSizeInBytes")
    .whitelisted_function("cudnnDestroyTensorDescriptor")
    .whitelisted_function("cudnnTransformTensor")
    .whitelisted_function("cudnnAddTensor")
    .whitelisted_type("cudnnOpTensorOp_t")
    .whitelisted_function("cudnnCreateOpTensorDescriptor")
    .whitelisted_function("cudnnSetOpTensorDescriptor")
    .whitelisted_function("cudnnGetOpTensorDescriptor")
    .whitelisted_function("cudnnDestroyOpTensorDescriptor")
    .whitelisted_function("cudnnOpTensor")
    .whitelisted_type("cudnnReduceTensorOp_t")
    .whitelisted_type("cudnnReduceTensorIndices_t")
    .whitelisted_type("cudnnIndicesType_t")
    .whitelisted_function("cudnnCreateReduceTensorDescriptor")
    .whitelisted_function("cudnnSetReduceTensorDescriptor")
    .whitelisted_function("cudnnGetReduceTensorDescriptor")
    .whitelisted_function("cudnnDestroyReduceTensorDescriptor")
    .whitelisted_function("cudnnGetReductionIndicesSize")
    .whitelisted_function("cudnnGetReductionWorkspaceSize")
    .whitelisted_function("cudnnReduceTensor")
    .whitelisted_function("cudnnSetTensor")
    .whitelisted_function("cudnnScaleTensor")
    .whitelisted_type("cudnnConvolutionMode_t")
    .whitelisted_function("cudnnCreateFilterDescriptor")
    .whitelisted_function("cudnnSetFilter4dDescriptor")
    .whitelisted_function("cudnnGetFilter4dDescriptor")
    .whitelisted_function("cudnnSetFilterNdDescriptor")
    .whitelisted_function("cudnnGetFilterNdDescriptor")
    .whitelisted_function("cudnnDestroyFilterDescriptor")
    .whitelisted_function("cudnnCreateConvolutionDescriptor")
    .whitelisted_function("cudnnSetConvolutionMathType")
    .whitelisted_function("cudnnGetConvolutionMathType")
    .whitelisted_function("cudnnSetConvolutionGroupCount")
    .whitelisted_function("cudnnGetConvolutionGroupCount")
    .whitelisted_function("cudnnSetConvolution2dDescriptor")
    .whitelisted_function("cudnnGetConvolution2dDescriptor")
    .whitelisted_function("cudnnGetConvolution2dForwardOutputDim")
    .whitelisted_function("cudnnSetConvolutionNdDescriptor")
    .whitelisted_function("cudnnGetConvolutionNdDescriptor")
    .whitelisted_function("cudnnGetConvolutionNdForwardOutputDim")
    .whitelisted_type("cudnnConvolutionFwdPreference_t")
    .whitelisted_type("cudnnConvolutionFwdAlgo_t")
    .whitelisted_type("cudnnConvolutionFwdAlgoPerf_t")
    .whitelisted_function("cudnnGetConvolutionForwardAlgorithmMaxCount")
    .whitelisted_function("cudnnFindConvolutionForwardAlgorithm")
    .whitelisted_function("cudnnFindConvolutionForwardAlgorithmEx")
    .whitelisted_function("cudnnGetConvolutionForwardAlgorithm")
    .whitelisted_function("cudnnGetConvolutionForwardAlgorithm_v7")
    .whitelisted_function("cudnnGetConvolutionForwardAlgorithmWorkspaceSize")
    .whitelisted_function("cudnnConvolutionForward")
    .whitelisted_type("cudnnConvolutionBwdFilterPreference_t")
    .whitelisted_type("cudnnConvolutionBwdFilterAlgo_t")
    .whitelisted_type("cudnnConvolutionBwdFilterAlgoPerf_t")
    .whitelisted_function("cudnnGetConvolutionBackwardFilterAlgorithmMaxCount")
    .whitelisted_function("cudnnFindConvolutionBackwardFilterAlgorithm")
    .whitelisted_function("cudnnFindConvolutionBackwardFilterAlgorithmEx")
    .whitelisted_function("cudnnGetConvolutionBackwardFilterAlgorithm")
    .whitelisted_function("cudnnGetConvolutionBackwardFilterAlgorithm_v7")
    .whitelisted_function("cudnnGetConvolutionBackwardFilterAlgorithmWorkspaceSize")
    .whitelisted_function("cudnnConvolutionBackwardFilter")
    .whitelisted_type("cudnnConvolutionBwdDataPreference_t")
    .whitelisted_type("cudnnConvolutionBwdDataAlgo_t")
    .whitelisted_type("cudnnConvolutionBwdDataAlgoPerf_t")
    .whitelisted_function("cudnnGetConvolutionBackwardDataAlgorithmMaxCount")
    .whitelisted_function("cudnnFindConvolutionBackwardDataAlgorithm")
    .whitelisted_function("cudnnFindConvolutionBackwardDataAlgorithmEx")
    .whitelisted_function("cudnnGetConvolutionBackwardDataAlgorithm")
    .whitelisted_function("cudnnGetConvolutionBackwardDataAlgorithm_v7")
    .whitelisted_function("cudnnGetConvolutionBackwardDataAlgorithmWorkspaceSize")
    .whitelisted_function("cudnnConvolutionBackwardFilter")
    .whitelisted_type("cudnnSoftmaxAlgorithm_t")
    .whitelisted_type("cudnnSoftmaxMode_t")
    .whitelisted_function("cudnnSoftmaxForward")
    .whitelisted_function("cudnnSoftmaxBackward")
    .whitelisted_type("cudnnPoolingMode_t")
    .whitelisted_function("cudnnCreatePoolingDescriptor")
    .whitelisted_function("cudnnSetPooling2dDescriptor")
    .whitelisted_function("cudnnGetPooling2dDescriptor")
    .whitelisted_function("cudnnSetPoolingNdDescriptor")
    .whitelisted_function("cudnnGetPoolingNdDescriptor")
    .whitelisted_function("cudnnDestroyPoolingDescriptor")
    .whitelisted_function("cudnnPoolingForward")
    .whitelisted_function("cudnnPoolingBackward")
    .whitelisted_type("cudnnActivationMode_t")
    .whitelisted_function("cudnnCreateActivationDescriptor")
    .whitelisted_function("cudnnSetActivationDescriptor")
    .whitelisted_function("cudnnGetActivationDescriptor")
    .whitelisted_function("cudnnDestroyActivationDescriptor")
    .whitelisted_function("cudnnActivationForward")
    .whitelisted_function("cudnnActivationBackward")
    .whitelisted_type("cudnnBatchNormMode_t")
    .whitelisted_function("cudnnDeriveBNTensorDescriptor")
    .whitelisted_function("cudnnBatchNormalizationForwardTraining")
    .whitelisted_function("cudnnBatchNormalizationForwardInference")
    .whitelisted_function("cudnnBatchNormalizationBackward")
    .whitelisted_type("cudnnDropoutStruct")
    .whitelisted_type("cudnnDropoutDescriptor_t")
    .whitelisted_function("cudnnCreateDropoutDescriptor")
    .whitelisted_function("cudnnDestroyDropoutDescriptor")
    .whitelisted_function("cudnnDropoutGetStateSpaceSize")
    .whitelisted_function("cudnnDropoutGetReserveSpaceSize")
    .whitelisted_function("cudnnSetDropoutDescriptor")
    .whitelisted_function("cudnnRestoreDropoutDescriptor")
    .whitelisted_function("cudnnGetDropoutDescriptor")
    .whitelisted_function("cudnnDropoutForward")
    .whitelisted_function("cudnnDropoutBackward")
    .generate()
    .expect("bindgen failed to generate cudnn bindings");
  cudnn_bindings
    .write_to_file(out_dir.join("cudnn_bind.rs"))
    .expect("bindgen failed to write cudnn bindings");
}
